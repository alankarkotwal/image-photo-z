Image Photo-Z
=============
___

##API Reference: 
This file documents the functions created and used in the package. For a complete description of the algorithm see the "Getting to know the image-photo-z pipeline" document.  

A. *catalog_gen* module: This module implements querying the SDSS SkyServer for a catalog of objects that image-photo-z may use.


  * Function _query\_area(outputCatalog, minRA, maxRA, minDec, maxDec)_  
    Queries DR10 via CasJobs to get a catalog of objects with clean photometric and spectrometric information in the specified area of the sky.  
    Parameters:
      * _outputCatalog_: _string_, Name of the output catalog file. ex.: "one_square_degree.csv".
	  * _minRA_: _float_, Minimum requested RA in degrees. ex.: 180.
	  * _maxRA_: _float_, Maximum requested RA in degrees. ex.: 181.
      * _minDec_: _float_, Minimum requested Dec in degrees. ex.: 45.
	  * _maxDec_: _float_, Minimum requested Dec in degrees. ex.: 46.
  
  * Function _finalize\_catalog(inputCatalog, outputCatalog)_  
    Finalizes the catalog generated by query_area for use by image-photo-z.  
    Parameters:
      * _inputCatalog_: _string_, Name of the input catalog file. ex.: "one_square_degree.csv".
      * _outputCatalog_: _string_, Name of the output catalog file. ex.: "one_square_degree_processed.csv".


B. *image_registration* module: This module implements registring images, that is, aligning them in different bands.


   * Function _register\_reproject(inputImages, outputImages, refImage, processDir, headerName="header.hdr")_  
     Registers input images using the reprojection routine in Montage.  
     Parameters:
       * _inputImages_: _list_, List of input image names. ex.: ["u.fits", "r.fits"].
       * _outputImages_: _list_, List of output image names. ex.: ["u\_reg.fits", "r\_reg.fits"].
       * _refImage_: _string_, Name of the reference image, one of  _inputImages_. ex.: "r.fits."
       * _processDir_: _string_, Name of the root of the directory where all images are kept. ex.: "processing".
       * _headerName_: _string_, optional, Name of the header file generated.

   * Function _reg\_check\_diff(check, ref, out)_  
     Checks image registration between _check_ and _ref_ by generating a difference image.  
     Parameters:
       * _check_: _string_, Name of the image whose registration is to be checked. ex.: "u_reg.fits".
       * _ref_: _string_, Name of the reference image. ex.: "r.fits".
       * _out_: _string_, Name of the generated difference image. ex.: "r\_diff.fits".


C. *generate_training* module: This module generates pixel training data as required by image-photo-z.


   * Function _preprocess\_catalog(catalog, output)_  
     Preprocess given catalog for generate_training.  
     Parameters:
       * _catalog_: _string_, Input catalog filename. ex.: "one_square_degree.csv".
       * _output_: _string_, Output catalog filename. ex.: "one_square_degree_processed.csv".

   * Function _generate\_download\_list(catalog, output, bands=['u','g','r','i','z'], rerun="301")_  
     Generates a image URL list of objects in _catalog_ to pass to _wget_ to download.  
     Parameters:
       * _catalog_: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _output_: _string_, Name of the output file. ex.: "download.list".
       * _bands_: _list_, optional, List of filters to download images in. ex.: ['u', 'r'].
       * _rerun_: _string_, optional, String of the current rerun number for the SDSS pipeline.
    
   * Function _download\_images(catalog, downloadFolder, logfile="logfile", bands=['u','g','r','i','z'], rerun="301")_  
     Generates a image URL list of objects in _catalog_ to pass to _wget_ to download.  
     Parameters:
       * _catalog_: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _output_: _string_, Name of the output file. ex.: "download.list".
       * _bands_: _list_, List of filters to download images in. ex.: ['u', 'r'].

   * Function _make_logfile(catalog, logfile="logfile")_  
     Generates a logfile of downloaded image names for further use.  
     Parameters:
       * _catalog_: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _logfile_: _string_, Name of the output logfile. ex.: "logfile".

   * Function _convert\_catalog\_to\_exp\_pixels(filename, catalog, expPixelsList)_  
     Converts a FITS header and the given catalog information to a list of expected pixel locations for objects.  
     Parameters:
       * _filename_: _string_, Name of the FITS file whose header is to be used. ex.: "r.fits".
       * _catalog_: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _expPixelsList_: _string_, Name of the output listfile. ex.: "sky.list".

   * Function _sextract(imageFileNames, configFileNames, processDir, refBand='r', bands=['u', 'g', 'r', 'i', 'z'])_  
     Runs SExtractor and associates objects from the expected pixels list to the detected objects.  
     Parameters:
       * _imageFileNames_: _list_, List of the FITS input image files. ex.: ["r.fits", "g.fits"].
       * _configFileNames_: _list_, List of SExtractor config files in the same order as the FITS files. ex.: ['u.sex', 'g.sex'].
       * _processDir_: _string_, Name of the process directory in which the images are kept. ex.: "processing".
       * _refBand_: _string_, optional, Reference band for the source extraction. ex.: 'r'.
       * _bands_: _list_, optional, List of filters in which images have to be processed. ex.: ['u', 'g', 'r', 'i', 'z']

   * Function _generate\_training\_objects(objectsFileName, segImageName, catalog, imageFileNames, catagory, outdir)_  
     Generates pixel-level training data.  
     Parameters:
       * _objectsFileName_: _string_, Name of the SExtractor output catalog file. ex.: "ref.cat".
       * _segImageName_: _string_, Name of the SExtractor output segmentation image. ex.: "ref_seg.fits".
       * _catalog_: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _imageFileNames_: _list_, List of the input filenames. ex.: ["r.fits", "g.fits"].
       * _catagory_: _list_, Type of pixels to choose. Some of ["GALAXY", "STAR", "QSO"].
       * _outdir_: _string_, Name of the directory in which output results should be placed. ex.: "data".


   * Function _generate\_training\_background(segImageNames, imageFileNames, outdir, nMaxDataPoints=1000)_  
     Generates pixel-level training data.  
     Parameters:
       * _segImageNames_: _list_, List of the SExtractor output segmentation image names. ex.: ["r_seg.fits", "u_seg.fits"].
       * _imageFileNames_: _list_, List of the input filenames. ex.: ["r.fits", "g.fits"].
       * _outdir_: _string_, Name of the directory in which output results should be placed. ex.: "data".
       * _nMaxDataPoints_: _int_, optional, Maximum number of background pixels to retain as data. ex.: 1000.

C. *training* module: This module trains a machine learning algorithm using data generated by generate_training. THis module currently implements training by k-nearest neighbors.


  * Function _prepare\_for\_training\_kNN\_regression(catagories, dataDir, outfiles)_
    Prepare data for regression training.
       * _catagory_: _list_, Type of pixels to choose. Some of ["GALAXY", "STAR", "QSO"].
       * _dataDir_: _string_, Name of the directory in which input results are located. ex.: "data".
       * _outfiles_: _list_, [Name of datafile, name of targetfile]. ex.: ["training/trainingData.train", "training/trainingTargets.train"].

  * Function _train\_test\_kNN\_regression(trainData, trainTargets, testData, testTargets, testPredictions, nNeighbors=5)_
    Train a kNN regressor and test it using some data.
       * _trainData_: _string_, Name of the training datafile. ex.: "trainingData.train".
       * _trainTargets_: _string_, Name of the training targetfile. ex.: "trainingTargets.train".
       * _testData_: _string_, Name of the testing datafile. ex.: "testingData.train".
       * _testTargets_: _string_, Name of the testing targetfile. ex.: "testingTargets.train".
       * _testPredictions_: _string_, Name of the testing prediction file. ex.: "testingPredictions.train".
       * _nNeighbors_: _int_, optional, Number of neighbors to use. ex.: 5.

  * Function _generate\_kNN\_output\_regression(testingPredictions, testingTargets, outfile)_
    Generate an output file consisting of predicted object averages and actual values from regression output files for further processing.
       * _testPredictions_: _string_, Name of the testing prediction file. ex.: "testingPredictions.train".
       * _testingTargets_: _string_, Name of the testing targetfile. ex.: "testingTargets.train".
       * _outfile_: _string_, Name of the output file. ex.: "kNNOutput_regression.csv".

  * Function _prepare\_for\_training\_kNN\_classification(catagories, dataDir, outfiles)_
    Prepare data for classification training.
       * _catagory_: _list_, Type of pixels to choose. Some of ["GALAXY", "STAR", "QSO"].
       * _dataDir_: _string_, Name of the directory in which input results are located. ex.: "data".
       * _outfiles_: _list_, [Name of datafile, name of targetfile]. ex.: ["training/trainingData.train", "training/trainingTargets.train"].

  * Function _train\_test\_kNN\_classification(trainData, trainTargets, testData, testTargets, testPredictions, nNeighbors=5)_
    Train a kNN classifier and test it using some data.
       * _trainData_: _string_, Name of the training datafile. ex.: "trainingData.train".
       * _trainTargets_: _string_, Name of the training targetfile. ex.: "trainingTargets.train".
       * _testData_: _string_, Name of the testing datafile. ex.: "testingData.train".
       * _testTargets_: _string_, Name of the testing targetfile. ex.: "testingTargets.train".
       * _testPredictions_: _string_, Name of the testing prediction file. ex.: "testingPredictions.train".
       * _nNeighbors_: _int_, optional, Number of neighbors to use. ex.: 5.

  * Function _generate\_kNN\_output\_classification(testingPredictions, testingTargets, outfile round_off=0)_
    Generate an output file consisting of predicted object averages and actual values from classification output files for further processing.
       * _testPredictions_: _string_, Name of the testing prediction file. ex.: "testingPredictions.train".
       * _testingTargets_: _string_, Name of the testing targetfile. ex.: "testingTargets.train".
       * _outfile_: _string_, Name of the output file. ex.: "kNNOutput_classification.csv".
       * _round\_off_: _bool_, Switch to select whether or not to round-off classification average results. One of "True" and "False".

C. *get_images* module: This module gets images from SDSS servers via Montage utilities.

  * Function _get\_image\_lists(obj, width, height, survey="SDSS", bands=['u','g','r','i','z'])_
    Generate image lists for the requested coordinates or object.
       * _obj_: _string_, Name of the requested object or coordinate pair. ex.: "m31", "180.24, 52.18".
       * _width_: _float_, Width of the requested frame in degrees. ex.: 1.2.
       * _height_: _float_, Height of the requested frame in degrees. ex.: 1.2.	
       * _survey_: _string_, optional, Name of the survey. One of "SDSS", "DSS", "2MASS", "DPOSS".
       * _band_: _list_, optional, List of the filter names in which images are to be obtained. A list of all filters for all surveys is given here.
          * SDSS: u, g, r, i, z
          * 2MASS: j, h, k
          * DPOSS: f, j, n
          * DSS: DSS1, DSS1R, DSS1B, DSS2, DSS2B, DSS2R, DSS2IR
