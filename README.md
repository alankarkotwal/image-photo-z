Image Photo-Z
=============

_Pixel-level estimation of photometric redshifts for astronomical images._

####Requirements:
* A computer running a Debian-like operating system, preferably Ubuntu 12.04 or higher.
* Python support and administrator access
* Software dependencies:
  * Python2.7 or higher (installed with the python-dev package)
  * Numpy
  * Astropy
  * Montage Image Mosaic Software for Astronomers
  * montage_wrapper package for Python
  * MLZ from LCDM and its dependencies

####Install Instructions:  
The setup-* scripts take care of the installation of the package.  
Install dependencies first by running the setup-deps script this way:

    cd <package path> 
    sudo chmod +x setup-deps.sh
    ./setup-deps.sh

Install the package by running

    sudo chmod +x setup.sh
    ./setup.sh

####Instructions For Use: 


A. *catalog_gen* module: This module implements querying the SDSS SkyServer for a catalog of objects that image-photo-z may use.


  * Function _query\_area(outputCatalog, minRA, maxRA, minDec, maxDec)_  
    Queries DR10 via CasJobs to get a catalog of objects with clean photometric and spectrometric information in the specified area of the sky.  
    Parameters:
      * _outputCatalog_: _string_, Name of the output catalog file. ex.: "one_square_degree.csv".
	  * _minRA_: _float_, Minimum requested RA in degrees. ex.: 180.
	  * _maxRA_: _float_, Maximum requested RA in degrees. ex.: 181.
      * _minDec_: _float_, Minimum requested Dec in degrees. ex.: 45.
	  * _maxDec_: _float_, Minimum requested Dec in degrees. ex.: 46.
  
  * Function _finalize\_catalog(inputCatalog, outputCatalog)_  
    Finalizes the catalog generated by query_area for use by image-photo-z.  
    Parameters:
      * _inputCatalog_: _string_, Name of the input catalog file. ex.: "one_square_degree.csv".
      * _outputCatalog_: _string_, Name of the output catalog file. ex.: "one_square_degree_processed.csv".


B. *image_registration* module: This module implements registring images, that is, aligning them in different bands.


   * Function _register\_reproject(inputImages, outputImages, refImage, processDir, headerName="header.hdr")_  
     Registers input images using the reprojection routine in Montage.  
     Parameters:
       * _inputImages_: _list_, List of input image names. ex.: ["u.fits", "r.fits"].
       * _outputImages_: _list_, List of output image names. ex.: ["u\_reg.fits", "r\_reg.fits"].
       * _refImage_: _string_, Name of the reference image, one of  _inputImages_. ex.: "r.fits."
       * _processDir_: _string_, Name of the root of the directory where all images are kept. ex.: "processing".
       * _headerName_: _string_, optional, Name of the header file generated.

   * Function _reg\_check\_diff(check, ref, out)_  
     Checks image registration between _check_ and _ref_ by generating a difference image.  
     Parameters:
       * _check_: _string_, Name of the image whose registration is to be checked. ex.: "u_reg.fits".
       * _ref_: _string_, Name of the reference image. ex.: "r.fits".
       * _out_: _string_, Name of the generated difference image. ex.: "r\_diff.fits".


C. *generate_training* module: This module generates pixel training data as required by image-photo-z.


   * Function _preprocess\_catalog(catalog, output)_  
     Preprocess given catalog for generate_training.  
     Parameters:
       * _catalog_: _string_, Input catalog filename. ex.: "one_square_degree.csv".
       * _output_: _string_, Output catalog filename. ex.: "one_square_degree_processed.csv".

   * Function _generate\_download\_list(catalog, output, bands=['u','g','r','i','z'], rerun="301")_  
     Generates a image URL list of objects in _catalog_ to pass to _wget_ to download.  
     Parameters:
       * _catalog_: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _output_: _string_, Name of the output file. ex.: "download.list".
       * _bands_: _list_, optional, List of filters to download images in. ex.: ['u', 'r'].
       * _rerun_: _string_, optional, String of the current rerun number for the SDSS pipeline.
    
   * Function _download\_images(catalog, downloadFolder, logfile="logfile", bands=['u','g','r','i','z'], rerun="301")_  
     Generates a image URL list of objects in _catalog_ to pass to _wget_ to download.  
     Parameters:
       * _catalog: _string_, Name of the catalog file. ex.: "one_square_degree_processed.csv".
       * _output_: _string_, Name of the output file. ex.: "download.list".
       * _bands_: _list_, List of filters to download images in. ex.: ['u', 'r'].


####Getting the code working:
The main script should do all the steps required for getting a pixel-level implementation of photometric redshift estimation running. 

	python main.py

The settings for the code may be done from the **config.cfg** file which is fairly self-explanatory. A different config file may be specified as follows:

	python main.py <config-file.conf>

A note on getting the catalog: for now, use the script Query\_Area.sql in catalog\_gen/sql in CasJobs to get the catalog while the catalog_gen module is being fixed.


####Miscellaneous Notes:  
All code has been written and tested on Ubuntu 12.04 LTS.  

####Contact:
Alankar Kotwal  
_alankarkotwal13@gmail.com_
